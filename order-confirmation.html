{{#partial "head"}}
{{{ checkout.checkout_head }}}
{{{ stylesheet '/assets/css/optimized-checkout.css' }}}
{{ getFontsCollection }}
<script>

fetch('/api/storefront/carts?include=lineItems.physicalItems.options',{credentials:'include'})
    .then(
        function(response) {
            if (response.status !== 200) {
                console.log('Looks like there was a problem. Status Code: ' + response.status);
                return;
            }

            // Examine the text in the response
            response.json().then(function(data) {
                var items = data[0].lineItems.physicalItems;

                // ==== GA4 Analytics
                var cartData = {
                    'event': 'begin_checkout',
                    'ecommerce': {
                        'items': []
                    }
                }

                // Insert order items into dataLayer
                for (var i = 0; i < items.length; i++){
                    var item = items[i],
                        variant = item.options[0] == undefined ? '' : item.options[0].value,
                        cartItem = {
                            'item_name': item.name,
                            'item_id': item.sku,
                            'price': item.extendedListPrice,
                            'item_variant': variant,
                            'quantity': item.quantity
                        }

                    cartData.ecommerce.items.push(cartItem);
                }

                dataLayer.push({ ecommerce: null });  // Clear the previous ecommerce object.
                dataLayer.push( cartData );
            });
        }
    );
</script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PZSWV8M');</script>
<!-- End Google Tag Manager -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PZSWV8M"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->



{{/partial}}

{{#partial "page"}}
<header class="checkoutHeader optimizedCheckout-header">
    <div class="checkoutHeader-content">
        <h1 class="is-srOnly">{{lang 'checkout.title'}}</h1>
        <h2 class="checkoutHeader-heading">
            <a class="checkoutHeader-link" href="{{urls.home}}">
                {{#if checkout.header_image}}
                    <img alt="{{settings.store_logo.title}}" class="checkoutHeader-logo" id="logoImage" src="{{ checkout.header_image }}"/>
                {{ else }}
                    <span class="header-logo-text">{{settings.store_logo.title}}</span>
                {{/if}}
            </a>
        </h2>
    </div>
</header>

{{{ checkout.order_confirmation_content }}}

{{/partial}}

{{> layout/empty}}
